from random import randint
from copy import deepcopy


class SudokuGrid():
	def __init__(self, width, **kwargs):
		self.width = width
		self.rows = self.build_rows(defval='')

	def build_rows(self, defval='', args=[], kwargs={}):
		'''
		Builds a list of x rows (x=width*3). Populates cells with empty string by default,
		but function can be called with a different function, such as randint(1,9).
		In this case, the function has to be called like this: self.build_rows(defval=randint,args=[1,9])
		'''	
		w = self.width*3
		rowlist = [[list() for i in range(w)] for i in range(w)]
		for r in range(w):
			for c in range(w):
				try:
					rowlist[r][c] = defval(*args, **kwargs)
				except:
					rowlist[r][c] = defval

		self.rows = rowlist
		self.cols = self.build_cols(rowlist)
		self.regions = self.build_regions(rowlist)
		self.coordrows, self.coordcols = self.build_coords(rowlist)
		self.coord_dict = self.build_coord_dict(rowlist,self.coordrows)
		return rowlist

	def build_cols(self, rows):
		'''
		Builds a list of x columns (x=width*3) from the rows generated by the above method. Used when building the grid coordinates.
		'''		
		colslist = []
		for col in range(self.width*3): #initializes list of cols
			colslist.append([])
		for row in rows:
			colindex = 0
			for col in row:
				colslist[colindex].append(col)
				colindex += 1
		return colslist

	def build_regions(self, rows):
		reglist = [list() for _ in range(len(rows))] 
		for i in range(0,9,3):
			for row in rows[i:i+3]:
				x = 0
				for I in range(3):
					reglist[I+i].extend(row[x:x+3])
					x += 3
		return reglist

	def print_grid(self, rows):
		'''
		Pretty prints the grid using a list of rows.
		'''
		rowstr = ''.join(map(str, rows[0]))
		cellen = len(rowstr)//(self.width*3)
		regsep = ('+' + ('-'*(cellen*3)) + ('----'))*self.width + '+'

		print(regsep)
		for y in range(0,self.width*3,3):
			for row in rows[y:y+3]:
				print('| ', end='')
				for x in range(0,self.width*3,3):
					print(*row[x:x+3], '| ', end='')
				print('')
			print(regsep)

	def printable_coords(self, rows): 
		'''
		Replaces the values populated on the grid by their coordinates. Returns a list of rows - much like build_rows().
		For widths or heights larger than 3, zeroes are inserted before the relevant coordinates to ensure symmetry.
		'''
		rowscopy = deepcopy(rows)
		colscopy = self.build_cols(rowscopy)
		max_irow_len = len(str(self.width*3))
		max_icol_len = len(str(self.width*3))
		for row in rowscopy:
			for item in row:
				icol = str(row.index(rowscopy[rowscopy.index(row)][row.index(item)]))
				while len(icol) < max_icol_len:
					icol = '0' + icol
				irow = str(rowscopy.index(row))
				while len(irow) < max_irow_len:
					irow = '0' + irow
				rowscopy[rowscopy.index(row)][row.index(item)] = irow + icol

		return rowscopy

	def build_coords(self, rows): 
		'''
		Replaces the values populated on the grid by their coordinates. Returns a list of rows containing tuple pairs..
		'''
		rowscopy = deepcopy(rows)
		colscopy = self.build_cols(rowscopy)
		

		for row in rowscopy:
			for item in row:
				newtuple = tuple()
				icol = row.index(rowscopy[rowscopy.index(row)][row.index(item)])
				irow = rowscopy.index(row)
				newtuple = irow, icol
				rowscopy[rowscopy.index(row)][row.index(item)] = newtuple
		
		coordscols = self.build_cols(rowscopy)

		return rowscopy, coordscols

	def build_coord_dict(self,rows,coords):
		'''
		Builds a dictionary, where keys are the coordinates built by build_coords(), and values are the actual values originally populated on the grid.
		'''
		coord_dict = {}
		for row in range(self.width*3):
			for col in range(self.width*3):
				coord_dict[coords[row][col]] = rows[row][col]
		return coord_dict

	def populate_grid(self, val='rand'):
		'''Populates the grid. Accepts one character
		or the keywords 'rand' (randomizes grid, the default) and 'clear' (clears grid).
		'''
		if val == 'rand':
			self.build_rows(defval=randint,args=[1,9])
			self.print_grid(self.rows)
		elif val == 'clear':
			self.build_rows(defval='')
			self.print_grid(self.rows)
		else:
			self.build_rows(defval=val)
			self.print_grid(self.rows)





			

t = SudokuGrid(3)


#t.populate_grid('a')
#t.print_grid(t.printable_coords(t.rows))
#t.print_grid(t.coordrows)
#print(t.coord_dict)

	











